---
title: "Group project assessment"
author: 'B241450, B249209, B253518'
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Task 1: Reproducing and improving figures

```{r load-wrangle}
library(tidyverse) 
library(here) #used to load data easier 
library(janitor) #used for the clean names function
library(ggrepel) #automatically aligns text in a graph to the correct place

postpartum_depression <- read.csv(here("data", "HIIT-postpartum-depression.csv")) %>% 
  clean_names() %>% 
  mutate(across(where(is.character), ~ na_if(., "#NULL!")))


```

### Figure 3

```{r figure-3}

fig3_PPD <- postpartum_depression %>% 
  select(starts_with("Edin")|starts_with("Int")) %>% #to select cols related to the edinburgh depression scale and intervention group
  rename("epdss" = edinburg_postnatal_depression_scale_score) %>% #rename for convenience
  transform(epdss = as.numeric(epdss)) %>% #convert from character to number
  drop_na()
  
#table with totals of each group
categorised_PPD_score <- fig3_PPD %>% 
  #categorising depression scores
  mutate(depression_level = case_when(epdss < 10 ~ "norm",
                                      epdss >= 10 & epdss <= 11 ~ "slightly_increased",
                                      epdss > 11 ~ "increased")) %>% 
  #creating totals of each depression score and grouping them by type of intervention
  group_by(depression_level, intervention_group) %>% 
  count(depression_level) %>% 
  pivot_wider(names_from = depression_level, values_from = n) %>% 
  #finding the totals in each intervention group
  mutate(totals = rowSums(across(c("increased" : "slightly_increased"))))



#finding percentages
percents_PPD_score <- categorised_PPD_score %>% 
  #finding percentages in each column and changing the name of the column
  rowwise() %>% 
  mutate(across(c(increased:slightly_increased), 
                ~ .x/totals*100, 
                .names = "percent_{.col}")) %>% 
  select(c(intervention_group, starts_with("percent"))) %>% 
  pivot_longer(starts_with("percent"), names_to = "depression_score", values_to = "percents") %>% 
  #changing the names of the intervention group - done after plotting to match to the original
  mutate(intervention_group = recode(intervention_group, "2" = "EDU - Educational Intervention Group",
                                     "1" = "HIIT - High Intensity Interval Training Group"))


#plot chart 
original_PPD_plot <- percents_PPD_score %>% 
  #re-ordering the position each variable appears in the original graph
  mutate(depression_score = fct_relevel(depression_score, 
                                        "percent_increased", "percent_slightly_increased", 
                                        "percent_norm"),
         intervention_group = fct_relevel(intervention_group, 
                                           "HIIT - High Intensity Interval Training Group", 
                                           "EDU - Educational Intervention Group")) %>% 
  ggplot(aes(x = percents, y = intervention_group, fill = depression_score)) +
  geom_col(width = 0.25) +
  #adjusting x-axis scale
  scale_x_continuous(breaks = seq(0, 100, by = 10), 
                     labels = scales :: label_percent(accuracy = 0.01, scale = 1)) +
  #adjusting the figure legend (changing text and fill colour) to match the original
  scale_fill_manual(breaks = c("percent_norm", "percent_slightly_increased", "percent_increased"), 
                    labels = c("percent_norm" = "range indicating the norm (below 10 points)",
                               "percent_slightly_increased" = 
                                 "slightly increased severity of PPD symptoms (10-11 points)",
                               "percent_increased" = "increased severity of PPD symptoms (12 or more points)"),
                    values = c("percent_norm" = "#8DB6F8", 
                                 "percent_slightly_increased" = "#083B92", 
                                 "percent_increased" = "#C32113")) +
  labs(x = "", y = "") + # removing labels for axis
  #formatting graph
  theme(axis.text = element_text(size = 8),
        legend.title = element_blank(),
        legend.position = "bottom",
        legend.direction = "vertical",
        panel.background = element_rect(fill = "white"),
        panel.grid.major.x = element_line(colour = "#D8D8D8", linewidth = 0.5),
        axis.ticks = element_blank())

original_PPD_plot



##IMPROVED PLOT

#preparing data to make a better plot
improved_categorised_PPD <- categorised_PPD_score %>%
  #re-code intervention group
  mutate(intervention_group = recode(intervention_group, "2" = "EDU",
                                     "1" = "HIIT")) %>% 
  select(!totals) %>% 
  pivot_longer(c(increased:slightly_increased), names_to = "depression_score", values_to = "count")


#improved plot
improved_PPD_plot <- improved_categorised_PPD %>% 
  #re-ordering position of variables on the plot
   mutate(depression_score = fct_relevel(depression_score, 
                                        "increased", "slightly_increased", 
                                        "norm")) %>% 
  ggplot(aes(x = intervention_group, y = count, fill = depression_score)) +
  geom_col(width = 0.3) +
  # #adjusting the figure legend (changing text and fill colour)
  scale_fill_manual(breaks = c("norm", "slightly_increased", "increased"), 
                    labels = c("norm" = "range indicating the norm (below 10 points)",
                               "slightly_increased" = 
                                 "slightly increased severity of PPD symptoms (10-11 points)",
                               "increased" = "increased severity of PPD symptoms (12 or more points)"),
                    values = c("norm" = "#8DB6F8", 
                                 "slightly_increased" = "#083B92", 
                                 "increased" = "#C32113")) +
  #changing break length in scales on y-axis
  scale_y_continuous(breaks = seq(0,35, by = 5)) +
  #adding captions and labels to the axis
  labs(caption = ("EDU = Educational Intervention Group
                  HIIT = High Intensity Interval Training Group"),
       x = "Intervention Group", 
       y = "Count",
       fill = "Categories of Edinburgh Postnatal Depression Scale") +
  #final formatting
  theme(axis.ticks = element_blank(),
        panel.background = element_rect(fill = "white"),
        panel.grid.major.y = element_line(colour = "darkgrey", linewidth = 0.5),
        panel.grid.minor.y = element_line(colour = "#D8D8D8", linewidth = 0.5),
        plot.caption.position = "plot", 
        plot.caption = element_text(size = 10.5))
  

improved_PPD_plot
```
-Plot type changed to a stacked bar charts with the counts of each category of depression score - allows for proportions of score categories in each group to still be seen and shows the differences in totals between intervention groups.  
-The stacked bar chart highlights the incorrect numbers of people in each intervention stated by the researchers (removed 6 data points from EDU group) 
-More breaks added, making it easier to read values for each depression score category from the graph 
-Intervention groups caption added - makes the x-axis less clustered 
-Added a legend title, clarifying what the legend is referring to   




### Figure 4

```{r figure-4}

# Tidy table for graph
psych_wellbeing <- postpartum_depression %>% 
  select(intervention_group, pre_fs_scale, post_fs_score, postnatal_florishing_scale_score) %>% 
  mutate(
    # Convert intervention_group before pivoting
    intervention_group = recode(intervention_group, "1" = "HIIT - High Intensity Interval Training Group", "2" = "EDU - Education"),
    pre_fs_scale = as.numeric(pre_fs_scale),
    post_fs_score = as.numeric(post_fs_score),
    postnatal_florishing_scale_score = as.numeric(postnatal_florishing_scale_score)
  ) %>% 
  pivot_longer(
    cols = c(pre_fs_scale, post_fs_score, postnatal_florishing_scale_score),
    names_to = "time",
    values_to = "fs_score"
  ) %>% 
  drop_na()

# Create summary statistics for plotting
psych_summary <- psych_wellbeing %>% 
  group_by(intervention_group, time) %>% 
  summarise(
    mean = mean(fs_score),
    sd = sd(fs_score),
    
    # Stats for advanced plot
    n = n(),
    se = sd/sqrt(n),
    t_value = qt(0.975, n - 1),
    ci_lower = mean - t_value * se,
    ci_upper = mean + t_value * se,
    .groups = "drop"
  ) %>% 
  mutate(
    # Fix the factor levels and labels to match the order
    time = factor(time, 
                  levels = c("pre_fs_scale", "post_fs_score", "postnatal_florishing_scale_score"),
                  labels = c("Before the intervention\n(II trimester of pregnancy)", 
                             "After the intervention\n(III trimester of pregnancy)", 
                             "Follow-up\n(± 5 months postpartum)")),
  )

# Plot graph
ggplot(psych_summary, 
       aes(x = time, y = mean, group = intervention_group)) +
  
  geom_line(
    aes(linetype = intervention_group),
    linewidth = 0.8) +
  
  geom_errorbar(
    aes(ymin = mean - sd, ymax = mean + sd),
    width = 0.08
  ) +
  
  geom_text_repel( # To fix labelling on graph
    aes(label = paste0("M = ", round(mean, 2))),
    size = 3
  ) +
  
  scale_linetype_manual(
    values = c("solid", "dashed")
  ) +
  
  scale_y_continuous(
    breaks = seq(40, 60, 2),
    labels = sprintf("%.2f", seq(40, 60, 2)) # to replicate s.f. of original graph
  ) +
  
  labs(
    x = "Psychological well-being (Flourishing Scale)",
    y = NULL,
    linetype = NULL
  ) +
  
  theme_minimal() +
  theme(legend.position = "bottom")
  
  

# Advanced graph
ggplot(psych_summary,
       aes(x = time, y = mean, group = intervention_group, colour = intervention_group)) +
  
  geom_line(
    linewidth = 0.9
  ) +
  
  geom_errorbar(
    aes(ymin = ci_lower, ymax = ci_upper, colour = intervention_group),
    width = 0.08,
    position = position_dodge(0.07) # slightly offsets errorbar
  ) +
  
  geom_text_repel(
    aes(label = paste0("M = ", round(mean, 2), "\n  n = ", n),
        colour = intervention_group),
    size = 3,
    show.legend = FALSE # to remove character displayed by legend
  ) +
  
  scale_y_continuous(
    breaks = seq(40, 60, 2),
    labels = sprintf("%.2f", seq(40, 60, 2)),
  ) +
  
  labs(
    x = "Psychological well-being (Flourishing Scale)",
    y = "Mean Flourishing Scale Score",
    linetype = NULL,
    colour = NULL,
    caption = "The error bars represent t-based 95% confidence interval (CI) bars"
  ) +
  
  theme_minimal() +
  theme(legend.position = "bottom")
```
Figure Four only:
-Sample sizes are explicitly labelled as “n” to allow the reader to understand what data was used in calculations and make judgements on whether the amount is useful

Changes to Figures Four and Five:
-Distinct colours were used for each intervention group, with position dodging applied to make it more obvious which group was which and make the separate error bars easier to spot
-A figure caption was added to clarify that error bars represent confidence intervals..
-The y-axis’ were labelled with to make it clearer what has been plotted on the graph
-We changed the standard deviation error bars in each figure to confidence interval. This shows the uncertainty about the mean rather than the variiability of results, making it is more useful for understanding whether the difference between the two groups is significant by looking for overlapping error bars.


### Figure 5

```{r figure-5}
#selecting just the relevant columns from the main data and removing any with NA's from this new set
figure_5_data <- postpartum_depression %>% 
  select(intervention_group, pre_sf_12_pcs_physicalhealthscale, post_sf12_pcs, postnatal_sf_12_pcs) %>% 
 drop_na() 
  


#-----------creating data that will be used for the original graph recreation-----------
figure_5_original_graph_data <-  figure_5_data %>% 
  
  #calculating means and sd from each timepoint for each group
  group_by(intervention_group) %>%  
  summarise(mean_pre  = mean(pre_sf_12_pcs_physicalhealthscale),
            mean_post = mean(as.numeric(post_sf12_pcs)),
            mean_postnatal = mean(as.numeric(postnatal_sf_12_pcs)),
            sd_pre = sd(pre_sf_12_pcs_physicalhealthscale),
            sd_post = sd(as.numeric(post_sf12_pcs)),
            sd_postnatal = sd(as.numeric(postnatal_sf_12_pcs))) %>% 
  
  #creates separate columns for whether its mean or sd and the timepoint
  pivot_longer(cols = -intervention_group, 
               names_to = c("statistic", "timepoint"),
               names_sep = "_",
               values_to = "value") %>% 
  
  #turning mean and sd into separate columns ready to plot
  pivot_wider(names_from = statistic,
              values_from = value) %>% 
 
  #turning timepoint into a factor and ordering it ready to plot
 mutate(timepoint = factor(timepoint, levels = c("pre", "post", "postnatal")),
        intervention_group = factor(intervention_group))



#--------------code for plotting the recreation of the original study's figure 5------------
figure_5_graph_original <- figure_5_original_graph_data %>% 
  ggplot(aes(x = timepoint, y = mean, group = intervention_group, linetype = intervention_group)) + 
  geom_line() +
  #plotting an error bar with sd
  geom_errorbar(aes(ymin = mean - sd, ymax = mean + sd), width = 0.08, linetype = "solid") + 
  #adding labels for each point
  geom_text_repel(aes(label = round(mean, 2))) +
  #setting the range of y axis displayed on the graph (had to use scales package to get 2dp)
  scale_y_continuous(limits = c(35, 60), labels = scales::label_number(accuracy = 0.01)) +
  #setting up the line types for the groups and their labels
  scale_linetype_manual(name = "", values = c("solid", "dotted"), labels = c("HIIT - High Intensity Interval Training Group", "EDU - Educational Intervention Group")) +
  #setting labels for the different timepoints on the x axis
   scale_x_discrete(labels = c( pre ="Before the intervention\n(II Trimester of Pregnancy)", post = "After the Intervention\n(III Trimester of Pregnancy)", postnatal = "Follow Up\n(± 5 Moths Postpartum)"))+
  
  xlab(bold("Physical Health") ~ "(measured with the Short Form Health Survey - physical subscale)") +
  ylab(NULL) +#removing unwanted y axis label 
  theme_minimal() +
  theme(legend.position = "bottom") +
    labs(caption = "Figure 5: Between-group differences in physical health. Note. The figure shows standard deviation (SD) bars.")


#-----------code for creating data to plot for my improved figure 5----------------
figure_5_improved_graph_data <-  figure_5_data %>% 
  group_by(intervention_group) %>%  
  #calculating means for each group and timepoint
  summarise(mean_pre = mean(pre_sf_12_pcs_physicalhealthscale),
            mean_post = mean(as.numeric(post_sf12_pcs)),
            mean_postnatal = mean(as.numeric(postnatal_sf_12_pcs)),
            #calculating sd for each group and timepoint
            sd_pre = sd(pre_sf_12_pcs_physicalhealthscale),
            sd_post = sd(as.numeric(post_sf12_pcs)),
            sd_postnatal = sd(as.numeric(postnatal_sf_12_pcs)),
            #calculating sample size for each group and timepoint
            sample_sizes = n()) %>% 
  
   #creates separate columns for whether its mean or sd and the timepoint
  pivot_longer(cols = -c(intervention_group, sample_sizes), 
               names_to = c("statistic", "timepoint"),
               names_sep = "_",
               values_to = "value") %>% 
   #turning mean and sd into separate columns ready to plot
  pivot_wider(names_from = statistic,
              values_from = value) %>% 
  #calculating standard errors, then t values, then the confidence intervals for each point
  mutate(standard_error = sd / sqrt(sample_sizes),
         t_value_95_percent = qt(0.975, sample_sizes - 1),
         ci_lower = mean - t_value_95_percent * standard_error,
         ci_upper = mean + t_value_95_percent * standard_error,
         #setting an order for the timepoint
    timepoint = factor(timepoint, levels = c("pre", "post", "postnatal")),
    intervention_group = factor(intervention_group))


#Creating a function to calculate the sample size of each intervention group
sample_size <-function(group){
  figure_5_data %>% 
  filter(intervention_group == group) %>% 
  summarise(n=n()) %>% 
  pull(n)
}

#calculating the size of each sample group
n_hiit <- sample_size("1")
n_edu <- sample_size("2")


#-------------Code to plot the improved figure 5-----------------
figure_5_graph_improved <- figure_5_improved_graph_data %>% 
  ggplot(aes(x = timepoint, y = mean, group = intervention_group, colour = intervention_group)) + 
  geom_line() +
  #setting error bars using confidence intervals
  geom_errorbar(aes(ymin = ci_lower, ymax = ci_upper), position = position_dodge(width = 0.1), width = 0.08) +
  #setting colours for the two lines and labelling the legend with sample size
  scale_colour_manual(name = "", values = c("salmon", "cyan3"), labels = c(paste0("HIIT - High Intensity Interval Training Group (n= ", n_hiit, ")"), paste0("EDU - Educational Intervention Group (n= ", n_edu, ")"))) +
  #labelling the three time points on the x axis
 scale_x_discrete(labels = c( pre ="Before the intervention\n(II Trimester of Pregnancy)", post  = "After the Intervention\n(III Trimester of Pregnancy)", postnatal = "Follow Up\n(± 5 Moths Postpartum)"))+
  #adding labels for each point with the mean
  geom_text_repel(aes(label = round(mean, 2))) +
  
    xlab(bold("Physical Health") ~ "(measured with the Short Form Health Survey - physical subscale)") +
  ylab("Mean Physical Health Score")+
    #setting the range of y axis displayed on the graph (had to use scales package to get 2dp)
  scale_y_continuous(limits = c(42.5, 52.5), labels = scales::label_number(accuracy = 0.01)) +
  theme_minimal() +
  theme(legend.position = "bottom") +
  labs(caption = "Figure 5: Between-group differences in physical health. Note. The figure shows confidence interval bars at 95%.")

#----------Displaying the two graphs-----------
figure_5_graph_original
figure_5_graph_improved

```
five only:
-Added sample sizes to legend as same for each point within intervention group for transparency 
-Reduced y axis range to make the differences in points more obvious as the gaps between means would be more significant for smaller means



## Task 2: FAIR data principles

The dataset provided contains missing metadata. While the authors are clear, they failed to identify exactly who collected and analysed the data, thereby decreasing the findability of the dataset. Other aspects of the metadata are clear: the year of data collection is given, and the title of the dataset is apt. Additionally, the dataset is an Excel document (readable by humans and computers), has a persistent identifier (DOI), and contact details for a researcher are given. These factors all influence the findability of the data. However, while the naming of the folder for the dataset is clear, the naming conventions of columns in the dataset itself were variable: they switch between using ‘fs’ and ‘flourishing scale’. For lay audiences, these acronyms can be hard to decipher. This is compounded by a lack of explanation of the acronyms in the supporting information. While definitions of the acronyms can be found in the tables included in the original article, explanations of acronyms used should be included in the metadata to make the dataset FAIRer by increasing interoperability. Additionally, metadata regarding what ‘1’ and ‘2’ mean in terms of intervention groups is missing. Correcting this would result in greater interoperability. It may be useful to create a README file with all this information to create a single point of reference (1).

The dataset is available under a Creative Commons International licence, allowing anyone to download the dataset and modify it. It includes no identifiable information, so it requires no authentication or authorisation, increasing its accessibility and reusability. The dataset is available on Mendeley Data and archived in the Data Archiving and Network Services (DANS), where it is stored ‘in perpetuity’, meaning the metadata of the dataset will be available in the DANS even if the original dataset is deleted, increasing its accessibility (2). 


## Task 3: Reproducibility brief

The dataset is publicly available online and easy to navigate, allowing for independent reanalysis of the data. This accessibility was essential, as it enabled us to attempt replication of the figures presented above. The software used for statistical analysis was explicitly stated, supporting replication of the analytical approach. The intervention methods were also clearly described, allowing them to be replicated in future studies. Furthermore, links and references to the original papers for the questionnaires and scales used were provided, enabling consistent reuse of validated measurement tools.

The paper currently lacks a few key details reducing its reproducibility. Firstly, they do not provide the exact scripts used to analyse and plot the data, preventing exact recreation, and instead requiring guesswork in what calculations and exclusions to use. Discrepancies between our results and those reported in the original study suggest that additional information such as more detailed coding procedures or data processing steps would be required to ensure full reproducibility The paper discussed using G\*Power for calculating minimum sample size without reporting the means and SDs used for this, the effect size they expected, or the test used for this calculation. This reduces reproducibility as we cannot verify the studies methodology is correct so recreating their other steps has less utility. This is because we do not know the justification for the sample size or how realistic the expected effect size was. For each result they analysed and plotted, they do not provide sample size for each group, meaning we don’t know how many of the stated participant numbers were excluded from the analysis, meaning we cannot exclude the same when doing this. Finally, they do not provide specific distributions of follow up time within the ±1 month, possibly creating variation when reproducing the study.

**References**

1. University of Cambridge. Adding metadata to your research data | Research Data Management [Internet]. [cited 2026 Feb 2]. Available from: https://www.data.cam.ac.uk/organising-storing/metadata

2. Mendeley Data. Archive Process [Internet]. [cited 2026 Feb 2]. Available from: https://data.mendeley.com/archive-process 
